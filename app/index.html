<!DOCTYPE html>
<html lang="en" ng-app="tidtrello">
<head>
    <meta charset="UTF-8">
    <title>TID Trello</title>
    <link rel="stylesheet" href="css/tidtrello.css" />
</head>
<body>
    <header>
        <h1>TID Trello</h1>
        <nav class="navigation">
            <ul>
                <li><a href="#/cards">Cards</a></li>
                <li><a href="#/user">User</a></li>
            </ul>
        </nav>
    </header>

    <div ng-view></div>

    <script src="js/lib/jquery.js"></script>
    <script src="js/lib/jquery-ui.js"></script>    
    <script src="js/lib/angular.js"></script>
    <script src="js/lib/angular-route.js"></script>
    <script src="js/lib/md5-min.js"></script>
    <script>
        angular.module('tidtrello', ['ngRoute']);
        
        angular.module('tidtrello').config(
            function($routeProvider) {
                $routeProvider.when('/cards', {
                    templateUrl: 'cards.html',
                    controller: 'CardController'
                });

                $routeProvider.when('/user', {
                    templateUrl: 'user.html',
                    controller: 'UserController'
                });

                $routeProvider.otherwise({
                    redirectTo: '/cards'
                });
            });

        angular.module('tidtrello').directive('card', function() {
            return {
                restrict: 'E',
                templateUrl: 'card.html',
                link: function(scope, element, attrs) {
                    element.draggable(); 
                }
            };
        });

        angular.module('tidtrello').controller('CardController', 
            function CardController($http, $location, $scope) {

                $scope.selectedStatus = "TODO";

                $scope.$watch('selectedStatus', function(value) {
                    //$location.path('/' + value);
                });

                $http.get('/api/cards').success(function(data) {
                    $scope.cards = data;
                });
            });

        angular.module('tidtrello').controller('UserController',
            function ($scope) {
                $scope.loggedUser = "davidg@tid.es";
            });

        angular.module('tidtrello').filter('gravatar',
            function() {
                return function(input) {
                    var md5 = input ? hex_md5(input) : '';
                    return 'http://www.gravatar.com/avatar/' + md5;
                };
            });

    </script>
</body>
</html>
