<!DOCTYPE html>
<html lang="en" ng-app="tidtrello">
<head>
    <meta charset="UTF-8">
    <title>TID Trello</title>
    <link rel="stylesheet" href="css/tidtrello.css" />
</head>
<body>
    <h1>TID Trello</h1>
    <div class="cards" ng-controller="CardController">
        <div class="card" ng-repeat="card in cards" 
          ng-click="selectCard(card)" ng-class="{ selected: card.selected }">
            <img ng-src="{{card.user | gravatar}}"/>
            <p>Title: {{card.title | uppercase }}</p>
            <p>User: {{card.user}}</p>
            <p>Description: {{card.description}}</p>
            <p>Date: {{card.date | date : 'MM/dd/yyyy @ h:mma'}}</p>
        </div>
    </div>
    <script src="js/lib/angular.js"></script>
    <script src="js/lib/md5-min.js"></script>
    <script>
        angular.module('tidtrello', []);
        
        angular.module('tidtrello').controller('CardController', 
            function CardController($scope) {
                $scope.cards = [
                    { 
                        title: 'Implement card controller',
                        user: 'davidg@tid.es',
                        description: 'A card controller needs to be implemented',
                        date: new Date()
                    },
                    { 
                        title: 'Gravatar filter bug',
                        user: 'jjmr@tid.es',
                        description: 'It doesnt work quite well',
                        date: new Date()
                    },
                    { 
                        title: 'Test documentation',
                        user: 'pjm@tid.es',
                        description: 'We need to write some tests!',
                        date: new Date()
                    }
                ];

                var selectedCard;
                $scope.selectCard = function(card) {
                    if (selectedCard) {
                        selectedCard.selected = false;
                    }
                    card.selected = true;
                    selectedCard = card;
                };
            });

        angular.module('tidtrello').filter('gravatar',
            function() {
                return function(input) {
                    var md5 = input ? hex_md5(input) : '';
                    return 'http://www.gravatar.com/avatar/' + md5;
                };
            });

    </script>
</body>
</html>
